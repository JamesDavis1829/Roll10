@using Roll10.Services
@using Roll10.Models
@inject GlobalRefreshService RefreshService
@inject DiceLogService DiceLogService
@inject PocketbaseService Pb
@inject IJSRuntime Js

<div>
    <ul class="list-none">
        @if(DiceLogService.DiceLog.Count > 0)
        {
            @foreach(var roll in DiceLogService.DiceLog)
            {
                <li class="even:bg-slate-200 p-2">
                    <p class="text-center font-bold">@roll.Title</p>
                    <p class="text-center italic">@roll.DiceRoll</p>
                    <p class="text-center font-bold text-lg">@roll.RolledAmount</p>
                </li>
            }
        }
        else
        {
            <li><p class="text-center font-italic">No rolls yet.</p></li>
        }
    </ul>
</div>

@code 
{
    protected override async Task OnInitializedAsync()
    {
        if(await Pb.IsLoginValid())
        {
            await Pb.SubscribeTo("diceroomlogs", "*", (message) => {
                Console.WriteLine(message);
            });
        }

        RefreshService.RefreshRequested += () => {
            this.StateHasChanged();
            Js.InvokeVoidAsync("scrollElementToBottom","#menu-container");
        };

        await base.OnInitializedAsync();
    }
}